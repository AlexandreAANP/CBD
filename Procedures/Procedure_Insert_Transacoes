create or replace PROCEDURE INSERT_TRANSACOES (fVALOR IN NUMBER,nCATEGORIA IN NUMBER,vEMISSOR IN NVARCHAR2,vRECETOR IN NVARCHAR2) AS 
    check_value CONTAS.F_SALDO%TYPE;
    vEXCEPTION EXCEPTION;
    
BEGIN
    SELECT F_SALDO INTO check_value FROM CONTAS WHERE V_IBAN = vEMISSOR;
    IF check_value < fVALOR THEN
        DBMS_OUTPUT.PUT_LINE('VALOR NA CONTA:' || check_value);
        RAISE vEXCEPTION;
    ELSE
        DBMS_OUTPUT.PUT_LINE('VALOR NA CONTA:' || check_value);

        INSERT INTO TRANSACOES(N_TRANSACAO, F_VALOR, D_DATA, N_CATEGORIA, V_EMISSOR, V_RECETOR) VALUES (DEFAULT, fVALOR, DEFAULT, nCATEGORIA, vEMISSOR, vRECETOR);
        UPDATE CONTAS SET F_SALDO = (CONTAS.F_SALDO + fVALOR) WHERE V_IBAN= vRECETOR;
        UPDATE CONTAS SET F_SALDO = (CONTAS.F_SALDO - fVALOR) WHERE V_IBAN = vEMISSOR;
    END IF;
EXCEPTION
    WHEN vEXCEPTION THEN
         INSERT_LOG('NAO TEM SALDO SUFICIENTE PARA TRANSFERIR O VALOR:' || fvalor);
         DBMS_OUTPUT.PUT_LINE('NAO TEM SALDO SUFICIENTE PARA TRANSFERIR O VALOR:' || fvalor);
END INSERT_TRANSACOES;
